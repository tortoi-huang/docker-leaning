services:

  oracle:
    image: truevoly/oracle-12c
    container_name: oracle-12c
    environment:
      # 用户 SYS 和 SYSTEM 的密码， 似乎不生效，默认密码是: oracle
      - PASS=Oradoc_db1
      # - ORACLE_CHARACTERSET=AL32UTF8
      # - APP_USER=appuser
      # - APP_USER_PASSWORD=app@123
    ports:
      - "1521:1521"
    volumes:
      # Persist data
      - oracle-data:/u01/app/oracle
      # 数据库初始化脚本，创建时执行一次，未测试
      # - ./config/entrypoint-initdb:/docker-entrypoint-initdb.d:ro
    # healthcheck:
    #   # healthcheck.sh 的第1个参数可指定要检测的 PDB 名称；不传则使用 ORACLE_DATABASE 或默认 XEPDB1
    #   test: ["CMD", "/opt/oracle/healthcheck.sh", "XEPDB1"]
    #   interval: 15s
    #   timeout: 10s
    #   retries: 30
    #   start_period: 90s
    networks: 
      - oracle-cdc

  kingbase:
    # 请先在本地构建这个镜像， 参考 compose/kingbase
    image: huang/kingbase:9.1.10
    pull_policy: never
    container_name: kingbase
    hostname: kingbase
    environment:
      KBASE_PASSWORD: Kb@1234
    volumes: 
      - kingbase_data:/data/kingbase/data
    ports:
      - "54321:54321"
    networks: 
      - oracle-cdc
  
  jobmanager:
    extends: 
      file: docker-compose-flink.yml
      service: jobmanager-temp
    container_name: jobmgr
    # 因为没有dns, task manager 需要通过 hostname 作为域名访问 jobmanager, 这里需要与 taskmanager 的配置参数 jobmanager.rpc.address 匹配
    hostname: jobmanager
    ports:
      - "8081:8081"
  
  taskmanager:
    extends:
      file: docker-compose-flink.yml
      service: taskmanager-temp
    # container_name: taskmgr0
    # hostname: taskmanager0
  # sql-gateway:
  #   extends: 
  #     file: docker-compose-flink.yml
  #     service: sql-gateway-temp
  #   container_name: sql
  #   hostname: sql-gateway
  #   ports:
  #     - "8083:8083"

volumes:
  oracle-data:
    driver: local
    driver_opts:
      type: 'none'
      o: 'bind'
      device: './data/oradata'
  kingbase_data:
    driver: local
    driver_opts:
      type: 'none'
      o: 'bind'
      device: './data/kingbase'

networks:
  oracle-cdc: 
    name: oracle-cdc